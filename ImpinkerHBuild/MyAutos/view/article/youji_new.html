<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/icons-extra.css" rel="stylesheet" />
		<style>
			textarea {
				border: 0;
				background-color: transparent;
				/*scrollbar-arrow-color:yellow;  
    scrollbar-base-color:lightsalmon;  
    overflow: hidden;*/
				grid-auto-rows: inherit;
				color: #666464;
				height: auto;
			}
			
			img {
				width: 100%;
			}
			
			.mui-content-padded {
				background-color: white;
			}
			
			.post-img {
				margin: 0 0 10px;
				position: relative;
			}
			
			.post-move {
				bottom: 23px;
				right: 5px;
				position: absolute;
			}
			
			a.move-up,
			a.move-down,
			a.del {
				background-color: #AAAAAA;
				background-size: 196px;
				background-position: -4px -86px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="title" class="mui-title">写游记</h1>
			<button id="publishyouji" class="mui-btn mui-btn-blue mui-btn-link mui-pull-right">发布</button>
		</header>
		<div class="mui-content">
			<div class="mui-input-group">
				<div class="mui-input-row">
					<input id="youi_title" type="text" placeholder="标题">
				</div>
			</div>
			<div>
				<a id='setcoverimage'>点击设置封面图</a>
				<img id='coverimage'>
			</div>
			<div class="mui-content-padded">
				<textarea name='yjcontent' placeholder="试试添加微博内容，秒速发游记..."></textarea>
				<!--<div class="post-img">
					<div class="add-img">
						<img src="http://img3.baa.bitautotech.com/img/V2img3.baa.bitautotech.com/usergroup/2017/5/14/7c836ed417184e0797e985450999b3e8_300_200_jpg.jpg" type="upload" fileprogressid="63fcdb1e-7dd5-4102-821b-1067bdeb3f12">
					</div>
					<div class="post-move" role="operator" style="">
						<a class="move-up mui-icon mui-icon-arrowup" role="up"></a>
						<a class="move-down mui-icon mui-icon-arrowdown" role="down"></a>
						<a class="del mui-icon mui-icon-trash" role="del"></a>
					</div>
				</div>
				<textarea name='yjcontent' placeholder="试试添加微博内容，秒速发游记..."></textarea>-->
			</div>
		</div>
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item" id="selectWeibo"><span class="mui-icon-extra mui-icon-extra-new"></span></a>
			<a class="mui-tab-item" id='addimage'><span class="mui-icon mui-icon-image"></span></a>
			<a class="mui-tab-item" id="share"><span class="mui-icon mui-icon-camera"></span></a>
			<a class="mui-tab-item" id="preview_btn"><span class="mui-icon mui-icon-search"></span></a>
		</nav>
		<script src="../../js/mui.js"></script>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/app.js"></script>
		<script type="text/javascript" src="../../js/article/youji_new.js"></script>
		<script type="text/javascript" src="../../js/commonUtil.js"></script>
		<script type='text/template' id='postimg'>
			<div class="post-img">
				<div class="add-img" name='yjcontent'>
					<img src="$src$" type="upload" fileprogressid="63fcdb1e-7dd5-4102-821b-1067bdeb3f12">
				</div>
				<div class="post-move" role="operator" style="">
					<a class="move-up mui-icon mui-icon-arrowup" role="up"></a>
					<a class="move-down mui-icon mui-icon-arrowdown" role="down"></a>
					<a class="del mui-icon mui-icon-trash" role="del"></a>
				</div>
			</div>
		</script>
		<script type="application/javascript">
			mui.init({});
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();

			});
			//自定义事件。接受选择微博页传回的数据
			window.addEventListener('weiboitems', function(event) {
				//获得事件参数  
				var selectedWeibos = event.detail.items;
				if(selectedWeibos != null) {
					//在页面上展示
					edityoujiUtil.showWeiBoItems(selectedWeibos);
				}
			});

			$("#youi_title").blur(function() {
				var content = $(this).val();
				console.log(content);
				if(content == "") return;
				//创建文章或更新标题
				setTimeout(function() {
					if(edityoujiUtil.article.articleid == 0) {
						edityoujiUtil.createYouji(content, function(id) {
							if(id != null && id > 0) {
								console.log(id);
								articleid = id;
							}
						});
					} else {
						edityoujiUtil.updateTitle(content, function(data) {

						});
					}
				}, 500);
			});
			//保存草稿
			$("#youji_content textarea").change(function() {
				setTimeout(function() {
					if(edityoujiUtil.article.articleid > 0) {
						edityoujiUtil.saveDraft(function(data) {
							console.log("保存草稿成功！");
						});
					} else {
						edityoujiUtil.createYouji("草稿" + (new Date().toLocaleString()), function(id) {
							if(id != null && id > 0) {
								console.log(id);
							}
						});
					}
				}, 2000);
			});
			//设置封面图
			document.getElementById('setcoverimage').addEventListener('tap', function() {
				edityoujiUtil.setCoverimage();
			});
			//发布
			document.getElementById('publishyouji').addEventListener('tap', function() {
				setTimeout(function() {
					edityoujiUtil.publishYouji(function(data) {
						console.log("发布成功！" + data);
						plus.webview.getLaunchWebview().reload();
						setTimeout(function() {
							mui.back();
						}, 500);
					});
				}, 500);
			});

			//添加图片
			document.getElementById('addimage').addEventListener('tap', function() {
				edityoujiUtil.addImage(function(data) {
					edityoujiUtil.showImage(data.Data, '');
				});
			});
			//添加微博
			document.getElementById('selectWeibo').addEventListener('tap', function() {
				mui.openWindow({
					url: "youji_new_selectweibo.html",
					id: "youji_new_selectweibo",
					createNew: true,
					show: {
						aniShow: 'slide-in-right',
						duration: 200
					}
				});
			});
			//预览
			document.getElementById('preview_btn').addEventListener('tap', function() {
				var resultStr = edityoujiUtil.getcontenthtml('yjcontent');
				mui.openWindow({
					url: "youji_preview.html",
					id: "youji_preview",
					createNew: true,
					show: {
						aniShow: 'slide-in-right',
						duration: 200
					},
					extras: {
						contentStr: resultStr
					},
				});
			});
		</script>
	</body>

</html>