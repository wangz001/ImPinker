<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/icons-extra.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/weibo.css" />
		<style type="text/css">
			.mui-card-content-inner {
				position: relative;
				padding: 5px;
			}
			.mui-card-content-inner p{
				margin-bottom: 5px;
			}
			.mui-card-content-inner .articlename{
				font-size: 17px;
				color: #333;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="title" class="mui-title">我的游记</h1>
		</header>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper ">
			<div class="mui-scroll">
				<div articleid='12' class="mui-card">
					<div class="mui-card-content">
						<div class="mui-card-content-inner">
							<p class="articlename" style="color: #333;font-size: 16;">名称</p>
							<p>Posted on 2017</p>
						</div>
					</div>
					<div class="mui-card-header mui-card-media" style="height:55vw;background-image:url(../../images/cbd.jpg)"></div>
				</div>
			</div>
		</div>

		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/app.js"></script>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/commonUtil.js"></script>
		<script type='text/template' id='articlelistitem'>
			<div articleid='$Id$' class="mui-card">
				<div class="mui-card-content">
					<div class="mui-card-content-inner">
						<p class="articlename" >$ArticleName$</p>
						<p>发表于 $CreateTime$</p>
					</div>
				</div>
				<div class="mui-card-header mui-card-media" style="height:55vw;background-image:url($CoverImage$)"></div>
			</div>

		</script>
		<script>
			mui.plusReady(function() {
				mui.init({
					swipeBack: false,
					pullRefresh: {
						container: '#pullrefresh',
						up: {
							auto: true, //可选,默认false.自动上拉加载一次
							contentrefresh: '正在加载...',
							callback: pullupRefresh
						}
					}

				});
			});
			//添加列表项的点击事件  
			mui('.mui-scroll').on('tap', '.mui-card', function(e) {
				var articleid = $(this).attr("articleid");
				console.log(articleid)
				var selectedItem = {};
				for(var i = 0; i < allDraftList.length; i++) {
					var item = allDraftList[i];
					if(item.Id.toString() == articleid) {
						selectedItem = item;
						break;
					}
				}
				mui.openWindow({
					id: 'preview',
					url: 'preview.html',
					styles: {
						popGesture: "close",

					},
					show: {
						aniShow: "pop-in"
					},
					waiting: {
						autoShow: false
					},
					extras: {
						articleUrl: "http://m.myautos.cn/Article/Index?id=" + articleid,
						articleid: articleid //扩展参数
					}
				});
			});

			//删文章
			var deleteArticle = function(articleid, callback) {
				callback = callback || $.noop;
				var url = 'http://api.myautos.cn/api/article/DeleteArticle';
				var data = {
					Id: articleid
				}
				commonUtil.sendRequestWithToken(url, data, true, function(data) {
					console.log(JSON.stringify(data));
					if(data.IsSuccess == 1 && data.Data != null && data.Data.length > 0) {
						return callback();
					} else {
						return callback(data.Description);
					}
				});
			}

			var pageNum = 1;
			var pageSize = 30;
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				var url = 'http://api.myautos.cn/api/article/GetMyArticle';
				var data = {
					pageNum: pageNum,
					pageSize: pageSize
				};
				commonUtil.sendRequestWithToken(url, data, false, function(data) {
					if(data.IsSuccess == 1 && data.Data != null && data.Data.length > 0) {
						var list = data.Data;
						allDraftList = list;
						for(var i = 0; i < list.length; i++) {
							var item = list[i];
							var imgTemplate = $('script[id="articlelistitem"]').html();
							var imgHtmlStr = imgTemplate.temp(item);
							$("#pullrefresh .mui-scroll").append(imgHtmlStr);
						}
						pageNum++;
					} else {
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
						return;
					}
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(); //参数为true代表没有更多数据了。
				});
			}
		</script>

	</body>

</html>