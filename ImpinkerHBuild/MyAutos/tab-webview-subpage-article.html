<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>article</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
		</style>
	</head>

	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div id="slider" class="mui-slider">
				<div class="mui-slider-group mui-slider-loop">
					<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="images/shuijiao.jpg">
						</a>
					</div>
					<!-- 第一张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="images/shuijiao.jpg">
						</a>
					</div>
					<!-- 第二张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="images/muwu.jpg">
						</a>
					</div>
					<!-- 第三张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="images/cbd.jpg">
						</a>
					</div>
					<!-- 第四张 -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="images/yuantiao.jpg">
						</a>
					</div>
					<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="images/shuijiao.jpg">
						</a>
					</div>
				</div>
				<div class="mui-slider-indicator">
					<div class="mui-indicator mui-active"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
				</div>
			</div>
			<div class="mui-scroll">
				<ul class="mui-table-view" id="list">
					<li class="mui-table-view-cell mui-media">
						<a href="view/article/preview.html">
							<img class="mui-media-object mui-pull-left" src="images/shuijiao.jpg">
							<div class="mui-media-body">
								幸福
								<p class="mui-ellipsis">能和心爱的人一起睡觉，是件幸福的事情；可是，打呼噜怎么办？</p>
							</div>
						</a>
					</li>
				</ul>
			</div>
		</div>
	<div id="share" class="mui-popover mui-popover-action mui-popover-bottom" style="display: none;">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#">拍照或录像</a>
				</li>
				<li class="mui-table-view-cell">
					<a href="#">选取现有的</a>
				</li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#picture" class=""><b>取消</b></a>
				</li>
			</ul>
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script>
		mui.init({
			swipeBack: false,
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					callback: pulldownRefresh
				},
				up: {
					auto: true, //可选,默认false.自动上拉加载一次
					contentrefresh: '正在加载...',
					callback: pullupRefresh
				}
			}
		});
		/**
		 * 下拉刷新具体业务实现
		 */
		function pulldownRefresh() {
			setTimeout(function() {
				var table = document.body.querySelector('.mui-table-view');
				var cells = document.body.querySelectorAll('.mui-table-view-cell');
				for(var i = cells.length, len = i + 3; i < len; i++) {
					var li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
					//下拉刷新，新纪录插到最前面；
					table.insertBefore(li, table.firstChild);
				}
				mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
			}, 1000);
		}
		var count = 0;
		/**
		 * 上拉加载具体业务实现
		 */
		var pageNum = 1;

		function pullupRefresh() {
			mui.ajax('http://api.myautos.cn/Article/GetByPage', {
				data: {
					pageNum: pageNum,
					pageSize: 10
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'get', //HTTP请求类型
				success: function(data) {
					var list = data.data;
					for(var i = 0; i < list.length; i++) {
						var item = list[i];
						var table = document.body.querySelector('.mui-table-view');
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell mui-media';
						li.innerHTML = '<a href="view/article/preview.html" articleid="' + item.Id + '">' +
							'<img class="mui-media-object mui-pull-left" src="' + item.CoverImage + '"><div class="mui-media-body">' +
							item.ArticleName + '<p class="mui-ellipsis">' + item.Company + '</p></div></a>';
						table.appendChild(li);
					}
					pageNum++;
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(); //参数为true代表没有更多数据了。
				}
			});
		}

		/*
		 * 列表点击事件
		 * */
		var aniShow = "pop-in";
		mui('#list').on('tap', 'a', function() {
			var id = this.getAttribute('href');
			var href = this.href;
			var type = "common"; // this.getAttribute("open-type");
			var articleid = this.getAttribute('articleid');
			//不使用父子模板方案的页面
			if(type == "common") {
				var webview_style = {
					popGesture: "close",
					
				};
				//侧滑菜单需动态控制一下zindex值；
				if(~id.indexOf('offcanvas-')) {
					webview_style.zindex = 9998;
					webview_style.popGesture = ~id.indexOf('offcanvas-with-right') ? "close" : "none";
				}
				//图标界面需要启动硬件加速
				if(~id.indexOf('icons.html')) {
					webview_style.hardwareAccelerated = true;
				}
				mui.openWindow({
					id: id,
					url: this.href,
					styles: webview_style,
					show: {
						aniShow: aniShow
					},
					waiting: {
						autoShow: false
					},
					extras: {
						articleid: "http://m.myautos.cn/Article/Index?id="+articleid //扩展参数
					}
				});
			} else if(id && ~id.indexOf('.html')) {
				if(!mui.os.plus || (!~id.indexOf('popovers.html') && mui.os.ios)) {
					mui.openWindow({
						id: id,
						url: this.href,
						styles: {
							popGesture: 'close'
						},
						show: {
							aniShow: aniShow
						},
						waiting: {
							autoShow: false
						}
					});
				} else {
					//TODO  by chb 当初这么设计，是为了一个App中有多个模板，目前仅有一个模板的情况下，实际上无需这么复杂
					//使用父子模板方案打开的页面
					//获得共用模板组
					var template = getTemplate('default');
					//判断是否显示右上角menu图标；
					var showMenu = ~href.indexOf('popovers.html') ? true : false;
					//获得共用父模板
					var headerWebview = template.header;
					//获得共用子webview
					var contentWebview = template.content;
					var title = this.innerText.trim();
					//通知模板修改标题，并显示隐藏右上角图标；
					mui.fire(headerWebview, 'updateHeader', {
						title: title,
						showMenu: showMenu,
						target: href,
						aniShow: aniShow
					});

					if(mui.os.ios || (mui.os.android && parseFloat(mui.os.version) < 4.4)) {
						var reload = true;
						if(!template.loaded) {
							if(contentWebview.getURL() != this.href) {
								contentWebview.loadURL(this.href);
							} else {
								reload = false;
							}
						} else {
							reload = false;
						}
						(!reload) && contentWebview.show();

						headerWebview.show(aniShow, 150);
					}
				}
			}
		});
	</script>

</html>